<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>dist/build/OpenCV/ImgProc/GeometricImgTransform.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-# LINE 1 "src/OpenCV/ImgProc/GeometricImgTransform.hsc" #-}</span>
<a name="line-2"></a><span class='hs-comment'>{-# language QuasiQuotes #-}</span>
<a name="line-3"></a><span class='hs-comment'>{-# LINE 2 "src/OpenCV/ImgProc/GeometricImgTransform.hsc" #-}</span>
<a name="line-4"></a><span class='hs-comment'>{-# language TemplateHaskell #-}</span>
<a name="line-5"></a>
<a name="line-6"></a><span class='hs-comment'>{- |
<a name="line-7"></a>
<a name="line-8"></a>The functions in this section perform various geometrical transformations of 2D
<a name="line-9"></a>images. They do not change the image content but deform the pixel grid and map
<a name="line-10"></a>this deformed grid to the destination image. In fact, to avoid sampling
<a name="line-11"></a>artifacts, the mapping is done in the reverse order, from destination to the
<a name="line-12"></a>source. That is, for each pixel @(x,y)@ of the destination image, the functions
<a name="line-13"></a>compute coordinates of the corresponding "donor" pixel in the source image and
<a name="line-14"></a>copy the pixel value:
<a name="line-15"></a>
<a name="line-16"></a>@dst(x,y) = src(fx(x,y), fy(x,y))@
<a name="line-17"></a>
<a name="line-18"></a>In case when you specify the forward mapping @\&lt;gx,gy&gt; : src -&gt; dst@, the OpenCV
<a name="line-19"></a>functions first compute the corresponding inverse mapping @\&lt;fx,fy&gt;:dst-&gt;src@
<a name="line-20"></a>and then use the above formula.
<a name="line-21"></a>
<a name="line-22"></a>The actual implementations of the geometrical transformations, from the most
<a name="line-23"></a>generic remap and to the simplest and the fastest resize, need to solve two main
<a name="line-24"></a>problems with the above formula:
<a name="line-25"></a>
<a name="line-26"></a>* Extrapolation of non-existing pixels.
<a name="line-27"></a>Similarly to the filtering functions described in the previous section, for some
<a name="line-28"></a>@(x,y)@, either one of @fx(x,y)@, or @fy(x,y)@, or both of them may fall outside
<a name="line-29"></a>of the image. In this case, an extrapolation method needs to be used. OpenCV
<a name="line-30"></a>provides the same selection of extrapolation methods as in the filtering
<a name="line-31"></a>functions. In addition, it provides the method 'BorderTransparent'. This means
<a name="line-32"></a>that the corresponding pixels in the destination image will not be modified at
<a name="line-33"></a>all.
<a name="line-34"></a>
<a name="line-35"></a>* Interpolation of pixel values.
<a name="line-36"></a>Usually @fx(x,y)@ and @fy(x,y)@ are floating-point numbers. This means that
<a name="line-37"></a>@\&lt;fx,fy&gt;@ can be either an affine or perspective transformation, or radial lens
<a name="line-38"></a>distortion correction, and so on. So, a pixel value at fractional coordinates
<a name="line-39"></a>needs to be retrieved. In the simplest case, the coordinates can be just rounded
<a name="line-40"></a>to the nearest integer coordinates and the corresponding pixel can be used. This
<a name="line-41"></a>is called a nearest-neighbor interpolation. However, a better result can be
<a name="line-42"></a>achieved by using more sophisticated interpolation methods , where a polynomial
<a name="line-43"></a>function is fit into some neighborhood of the computed pixel
<a name="line-44"></a>@(fx(x,y),fy(x,y))@, and then the value of the polynomial at @(fx(x,y),fy(x,y))@
<a name="line-45"></a>is taken as the interpolated pixel value. In OpenCV, you can choose between
<a name="line-46"></a>several interpolation methods. See resize for details.
<a name="line-47"></a>-}</span>
<a name="line-48"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>OpenCV</span><span class='hs-varop'>.</span><span class='hs-conid'>ImgProc</span><span class='hs-varop'>.</span><span class='hs-conid'>GeometricImgTransform</span>
<a name="line-49"></a>    <span class='hs-layout'>(</span> <span class='hs-conid'>ResizeAbsRel</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span>
<a name="line-50"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>resize</span>
<a name="line-51"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>warpAffine</span>
<a name="line-52"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>warpPerspective</span>
<a name="line-53"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>invertAffineTransform</span>
<a name="line-54"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>getRotationMatrix2D</span>
<a name="line-55"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>remap</span>
<a name="line-56"></a>    <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-57"></a>
<a name="line-58"></a><span class='hs-keyword'>import</span> <span class='hs-str'>"base"</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Int</span> <span class='hs-layout'>(</span> <span class='hs-conid'>Int32</span> <span class='hs-layout'>)</span>
<a name="line-59"></a><span class='hs-keyword'>import</span> <span class='hs-str'>"base"</span> <span class='hs-conid'>Foreign</span><span class='hs-varop'>.</span><span class='hs-conid'>C</span><span class='hs-varop'>.</span><span class='hs-conid'>Types</span> <span class='hs-layout'>(</span> <span class='hs-conid'>CFloat</span><span class='hs-layout'>,</span> <span class='hs-conid'>CDouble</span> <span class='hs-layout'>)</span>
<a name="line-60"></a><span class='hs-keyword'>import</span> <span class='hs-str'>"base"</span> <span class='hs-conid'>System</span><span class='hs-varop'>.</span><span class='hs-conid'>IO</span><span class='hs-varop'>.</span><span class='hs-conid'>Unsafe</span> <span class='hs-layout'>(</span> <span class='hs-varid'>unsafePerformIO</span> <span class='hs-layout'>)</span>
<a name="line-61"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-str'>"inline-c"</span> <span class='hs-conid'>Language</span><span class='hs-varop'>.</span><span class='hs-conid'>C</span><span class='hs-varop'>.</span><span class='hs-conid'>Inline</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>C</span>
<a name="line-62"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-str'>"inline-c"</span> <span class='hs-conid'>Language</span><span class='hs-varop'>.</span><span class='hs-conid'>C</span><span class='hs-varop'>.</span><span class='hs-conid'>Inline</span><span class='hs-varop'>.</span><span class='hs-conid'>Unsafe</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>CU</span>
<a name="line-63"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-str'>"inline-c-cpp"</span> <span class='hs-conid'>Language</span><span class='hs-varop'>.</span><span class='hs-conid'>C</span><span class='hs-varop'>.</span><span class='hs-conid'>Inline</span><span class='hs-varop'>.</span><span class='hs-conid'>Cpp</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>C</span>
<a name="line-64"></a><span class='hs-keyword'>import</span> <span class='hs-str'>"linear"</span> <span class='hs-conid'>Linear</span><span class='hs-varop'>.</span><span class='hs-conid'>V2</span> <span class='hs-layout'>(</span> <span class='hs-conid'>V2</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span> <span class='hs-layout'>)</span>
<a name="line-65"></a><span class='hs-keyword'>import</span> <span class='hs-str'>"linear"</span> <span class='hs-conid'>Linear</span><span class='hs-varop'>.</span><span class='hs-conid'>Vector</span> <span class='hs-layout'>(</span> <span class='hs-varid'>zero</span> <span class='hs-layout'>)</span>
<a name="line-66"></a><span class='hs-keyword'>import</span> <span class='hs-str'>"this"</span> <span class='hs-conid'>OpenCV</span><span class='hs-varop'>.</span><span class='hs-conid'>Core</span><span class='hs-varop'>.</span><span class='hs-conid'>Types</span>
<a name="line-67"></a><span class='hs-keyword'>import</span> <span class='hs-str'>"this"</span> <span class='hs-conid'>OpenCV</span><span class='hs-varop'>.</span><span class='hs-conid'>ImgProc</span><span class='hs-varop'>.</span><span class='hs-conid'>Types</span>
<a name="line-68"></a><span class='hs-keyword'>import</span> <span class='hs-str'>"this"</span> <span class='hs-conid'>OpenCV</span><span class='hs-varop'>.</span><span class='hs-conid'>Internal</span><span class='hs-varop'>.</span><span class='hs-conid'>C</span><span class='hs-varop'>.</span><span class='hs-conid'>Inline</span> <span class='hs-layout'>(</span> <span class='hs-varid'>openCvCtx</span> <span class='hs-layout'>)</span>
<a name="line-69"></a><span class='hs-keyword'>import</span> <span class='hs-str'>"this"</span> <span class='hs-conid'>OpenCV</span><span class='hs-varop'>.</span><span class='hs-conid'>Internal</span><span class='hs-varop'>.</span><span class='hs-conid'>C</span><span class='hs-varop'>.</span><span class='hs-conid'>Types</span>
<a name="line-70"></a><span class='hs-keyword'>import</span> <span class='hs-str'>"this"</span> <span class='hs-conid'>OpenCV</span><span class='hs-varop'>.</span><span class='hs-conid'>Internal</span><span class='hs-varop'>.</span><span class='hs-conid'>Core</span><span class='hs-varop'>.</span><span class='hs-conid'>Types</span><span class='hs-varop'>.</span><span class='hs-conid'>Mat</span>
<a name="line-71"></a><span class='hs-keyword'>import</span> <span class='hs-str'>"this"</span> <span class='hs-conid'>OpenCV</span><span class='hs-varop'>.</span><span class='hs-conid'>Internal</span><span class='hs-varop'>.</span><span class='hs-conid'>Exception</span>
<a name="line-72"></a><span class='hs-keyword'>import</span> <span class='hs-str'>"this"</span> <span class='hs-conid'>OpenCV</span><span class='hs-varop'>.</span><span class='hs-conid'>Internal</span><span class='hs-varop'>.</span><span class='hs-conid'>ImgProc</span><span class='hs-varop'>.</span><span class='hs-conid'>Types</span>
<a name="line-73"></a><span class='hs-keyword'>import</span> <span class='hs-str'>"this"</span> <span class='hs-conid'>OpenCV</span><span class='hs-varop'>.</span><span class='hs-conid'>TypeLevel</span>
<a name="line-74"></a>
<a name="line-75"></a><span class='hs-comment'>--------------------------------------------------------------------------------</span>
<a name="line-76"></a>
<a name="line-77"></a><span class='hs-conid'>C</span><span class='hs-varop'>.</span><span class='hs-varid'>context</span> <span class='hs-varid'>openCvCtx</span>
<a name="line-78"></a>
<a name="line-79"></a><span class='hs-conid'>C</span><span class='hs-varop'>.</span><span class='hs-varid'>include</span> <span class='hs-str'>"opencv2/core.hpp"</span>
<a name="line-80"></a><span class='hs-conid'>C</span><span class='hs-varop'>.</span><span class='hs-varid'>include</span> <span class='hs-str'>"opencv2/imgproc.hpp"</span>
<a name="line-81"></a><span class='hs-conid'>C</span><span class='hs-varop'>.</span><span class='hs-varid'>using</span> <span class='hs-str'>"namespace cv"</span>
<a name="line-82"></a>
<a name="line-83"></a>
<a name="line-84"></a><span class='hs-comment'>{-# LINE 82 "src/OpenCV/ImgProc/GeometricImgTransform.hsc" #-}</span>
<a name="line-85"></a>
<a name="line-86"></a><span class='hs-comment'>{-# LINE 83 "src/OpenCV/ImgProc/GeometricImgTransform.hsc" #-}</span>
<a name="line-87"></a>
<a name="line-88"></a><span class='hs-comment'>{-# LINE 84 "src/OpenCV/ImgProc/GeometricImgTransform.hsc" #-}</span>
<a name="line-89"></a>
<a name="line-90"></a>
<a name="line-91"></a><span class='hs-comment'>{-# LINE 86 "src/OpenCV/ImgProc/GeometricImgTransform.hsc" #-}</span>
<a name="line-92"></a>
<a name="line-93"></a><span class='hs-comment'>--------------------------------------------------------------------------------</span>
<a name="line-94"></a>
<a name="line-95"></a><a name="ResizeAbsRel"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>ResizeAbsRel</span>
<a name="line-96"></a>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ResizeAbs</span> <span class='hs-conid'>Size2i</span> <span class='hs-comment'>-- ^ Resize to an absolute size.</span>
<a name="line-97"></a>   <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ResizeRel</span> <span class='hs-layout'>(</span><span class='hs-conid'>V2</span> <span class='hs-conid'>Double</span><span class='hs-layout'>)</span>
<a name="line-98"></a>     <span class='hs-comment'>-- ^ Resize with relative factors for both the width and the height.</span>
<a name="line-99"></a>     <span class='hs-keyword'>deriving</span> <span class='hs-conid'>Show</span>
<a name="line-100"></a>
<a name="line-101"></a><a name="marshalResizeAbsRel"></a><span class='hs-definition'>marshalResizeAbsRel</span>
<a name="line-102"></a>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ResizeAbsRel</span>
<a name="line-103"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Size2i</span><span class='hs-layout'>,</span> <span class='hs-conid'>CDouble</span><span class='hs-layout'>,</span> <span class='hs-conid'>CDouble</span><span class='hs-layout'>)</span>
<a name="line-104"></a><span class='hs-definition'>marshalResizeAbsRel</span> <span class='hs-layout'>(</span><span class='hs-conid'>ResizeAbs</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>s</span><span class='hs-layout'>,</span> <span class='hs-num'>0</span>   <span class='hs-layout'>,</span> <span class='hs-num'>0</span>   <span class='hs-layout'>)</span>
<a name="line-105"></a><span class='hs-definition'>marshalResizeAbsRel</span> <span class='hs-layout'>(</span><span class='hs-conid'>ResizeRel</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>s</span><span class='hs-layout'>,</span> <span class='hs-varid'>c'fx</span><span class='hs-layout'>,</span> <span class='hs-varid'>c'fy</span><span class='hs-layout'>)</span>
<a name="line-106"></a>  <span class='hs-keyword'>where</span>
<a name="line-107"></a>    <span class='hs-varid'>s</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Size2i</span>
<a name="line-108"></a>    <span class='hs-varid'>s</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>toSize</span> <span class='hs-layout'>(</span><span class='hs-varid'>zero</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>V2</span> <span class='hs-conid'>Int32</span><span class='hs-layout'>)</span>
<a name="line-109"></a>
<a name="line-110"></a>    <span class='hs-layout'>(</span><span class='hs-conid'>V2</span> <span class='hs-varid'>c'fx</span> <span class='hs-varid'>c'fy</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>realToFrac</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>f</span>
<a name="line-111"></a>
<a name="line-112"></a><a name="resize"></a><span class='hs-comment'>{- | Resizes an image
<a name="line-113"></a>
<a name="line-114"></a>To shrink an image, it will generally look best with 'InterArea' interpolation,
<a name="line-115"></a>whereas to enlarge an image, it will generally look best with 'InterCubic'
<a name="line-116"></a>(slow) or 'InterLinear' (faster but still looks OK).
<a name="line-117"></a>
<a name="line-118"></a>Example:
<a name="line-119"></a>
<a name="line-120"></a>@
<a name="line-121"></a>resizeInterAreaImg :: Mat ('S ['D, 'D]) ('S 3) ('S Word8)
<a name="line-122"></a>resizeInterAreaImg = exceptError $
<a name="line-123"></a>    withMatM (h ::: w + (w \`div` 2) ::: Z)
<a name="line-124"></a>             (Proxy :: Proxy 3)
<a name="line-125"></a>             (Proxy :: Proxy Word8)
<a name="line-126"></a>             transparent $ \imgM -&gt; do
<a name="line-127"></a>      birds_resized &lt;-
<a name="line-128"></a>        pureExcept $ resize (ResizeRel $ pure 0.5) InterArea birds_768x512
<a name="line-129"></a>      matCopyToM imgM (V2 0 0) birds_768x512 Nothing
<a name="line-130"></a>      matCopyToM imgM (V2 w 0) birds_resized Nothing
<a name="line-131"></a>      lift $ arrowedLine imgM (V2 startX y) (V2 pointX y) red 4 LineType_8 0 0.15
<a name="line-132"></a>  where
<a name="line-133"></a>    [h, w] = miShape $ matInfo birds_768x512
<a name="line-134"></a>    startX = round $ fromIntegral w * (0.95 :: Double)
<a name="line-135"></a>    pointX = round $ fromIntegral w * (1.05 :: Double)
<a name="line-136"></a>    y = h \`div` 4
<a name="line-137"></a>@
<a name="line-138"></a>
<a name="line-139"></a>&lt;&lt;doc/generated/examples/resizeInterAreaImg.png resizeInterAreaImg&gt;&gt;
<a name="line-140"></a>
<a name="line-141"></a>&lt;<a href="http://docs.opencv.org/3.0-last-rst/modules/imgproc/doc/geometric_transformations.html#resize">http://docs.opencv.org/3.0-last-rst/modules/imgproc/doc/geometric_transformations.html#resize</a> OpenCV Sphinx doc&gt;
<a name="line-142"></a>-}</span>
<a name="line-143"></a><span class='hs-definition'>resize</span>
<a name="line-144"></a>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ResizeAbsRel</span>
<a name="line-145"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>InterpolationMethod</span>
<a name="line-146"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Mat</span> <span class='hs-layout'>(</span><span class='hs-chr'>'</span><span class='hs-conid'>S</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>height</span><span class='hs-layout'>,</span> <span class='hs-varid'>width</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-varid'>channels</span> <span class='hs-varid'>depth</span>
<a name="line-147"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CvExcept</span> <span class='hs-layout'>(</span><span class='hs-conid'>Mat</span> <span class='hs-layout'>(</span><span class='hs-chr'>'</span><span class='hs-conid'>S</span> <span class='hs-keyglyph'>[</span><span class='hs-chr'>'</span><span class='hs-conid'>D</span><span class='hs-layout'>,</span> <span class='hs-chr'>'</span><span class='hs-conid'>D</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-varid'>channels</span> <span class='hs-varid'>depth</span><span class='hs-layout'>)</span>
<a name="line-148"></a><span class='hs-definition'>resize</span> <span class='hs-varid'>factor</span> <span class='hs-varid'>interpolationMethod</span> <span class='hs-varid'>src</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unsafeWrapException</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-149"></a>    <span class='hs-varid'>dst</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>newEmptyMat</span>
<a name="line-150"></a>    <span class='hs-varid'>handleCvException</span> <span class='hs-layout'>(</span><span class='hs-varid'>pure</span> <span class='hs-varop'>$</span> <span class='hs-varid'>unsafeCoerceMat</span> <span class='hs-varid'>dst</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span>
<a name="line-151"></a>      <span class='hs-varid'>withPtr</span> <span class='hs-varid'>src</span>   <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>srcPtr</span>   <span class='hs-keyglyph'>-&gt;</span>
<a name="line-152"></a>      <span class='hs-varid'>withPtr</span> <span class='hs-varid'>dst</span>   <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>dstPtr</span>   <span class='hs-keyglyph'>-&gt;</span>
<a name="line-153"></a>      <span class='hs-varid'>withPtr</span> <span class='hs-varid'>dsize</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>dsizePtr</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-154"></a>        <span class='hs-keyglyph'>[</span><span class='hs-varid'>cvExcept</span><span class='hs-keyglyph'>|</span>
<a name="line-155"></a>          <span class='hs-varid'>cv</span><span class='hs-keyglyph'>::</span><span class='hs-varid'>resize</span>
<a name="line-156"></a>          <span class='hs-layout'>(</span> <span class='hs-varop'>*$</span><span class='hs-layout'>(</span><span class='hs-conid'>Mat</span> <span class='hs-varop'>*</span> <span class='hs-varid'>srcPtr</span><span class='hs-layout'>)</span>
<a name="line-157"></a>          <span class='hs-layout'>,</span> <span class='hs-varop'>*$</span><span class='hs-layout'>(</span><span class='hs-conid'>Mat</span> <span class='hs-varop'>*</span> <span class='hs-varid'>dstPtr</span><span class='hs-layout'>)</span>
<a name="line-158"></a>          <span class='hs-layout'>,</span> <span class='hs-varop'>*$</span><span class='hs-layout'>(</span><span class='hs-conid'>Size2i</span> <span class='hs-varop'>*</span> <span class='hs-varid'>dsizePtr</span><span class='hs-layout'>)</span>
<a name="line-159"></a>          <span class='hs-layout'>,</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>double</span> <span class='hs-varid'>fx</span><span class='hs-layout'>)</span>
<a name="line-160"></a>          <span class='hs-layout'>,</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>double</span> <span class='hs-varid'>fy</span><span class='hs-layout'>)</span>
<a name="line-161"></a>          <span class='hs-layout'>,</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>int32_t</span> <span class='hs-varid'>c'interpolation</span><span class='hs-layout'>)</span>
<a name="line-162"></a>          <span class='hs-layout'>)</span><span class='hs-layout'>;</span>
<a name="line-163"></a>        <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-164"></a>  <span class='hs-keyword'>where</span>
<a name="line-165"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>dsize</span><span class='hs-layout'>,</span> <span class='hs-varid'>fx</span><span class='hs-layout'>,</span> <span class='hs-varid'>fy</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>marshalResizeAbsRel</span> <span class='hs-varid'>factor</span>
<a name="line-166"></a>    <span class='hs-varid'>c'interpolation</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>marshalInterpolationMethod</span> <span class='hs-varid'>interpolationMethod</span>
<a name="line-167"></a>
<a name="line-168"></a><a name="c'WARP_FILL_OUTLIERS"></a><span class='hs-definition'>c'WARP_FILL_OUTLIERS</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>8</span>
<a name="line-169"></a><span class='hs-definition'>c'WARP_FILL_OUTLIERS</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Num</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>a</span>
<a name="line-170"></a>
<a name="line-171"></a><a name="c'WARP_INVERSE_MAP"></a><span class='hs-comment'>{-# LINE 163 "src/OpenCV/ImgProc/GeometricImgTransform.hsc" #-}</span>
<a name="line-172"></a><span class='hs-definition'>c'WARP_INVERSE_MAP</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>16</span>
<a name="line-173"></a><span class='hs-definition'>c'WARP_INVERSE_MAP</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Num</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>a</span>
<a name="line-174"></a>
<a name="line-175"></a><span class='hs-comment'>{-# LINE 164 "src/OpenCV/ImgProc/GeometricImgTransform.hsc" #-}</span>
<a name="line-176"></a>
<a name="line-177"></a><a name="warpAffine"></a><span class='hs-comment'>{- | Applies an affine transformation to an image
<a name="line-178"></a>
<a name="line-179"></a>Example:
<a name="line-180"></a>
<a name="line-181"></a>@
<a name="line-182"></a>rotateBirds :: Mat (ShapeT [2, 3]) ('S 1) ('S Double)
<a name="line-183"></a>rotateBirds = getRotationMatrix2D (V2 256 170 :: V2 CFloat) 45 0.75
<a name="line-184"></a>
<a name="line-185"></a>warpAffineImg :: Birds_512x341
<a name="line-186"></a>warpAffineImg = exceptError $
<a name="line-187"></a>    warpAffine birds_512x341 rotateBirds InterArea False False (BorderConstant black)
<a name="line-188"></a>
<a name="line-189"></a>warpAffineInvImg :: Birds_512x341
<a name="line-190"></a>warpAffineInvImg = exceptError $
<a name="line-191"></a>    warpAffine warpAffineImg rotateBirds InterCubic True False (BorderConstant black)
<a name="line-192"></a>@
<a name="line-193"></a>
<a name="line-194"></a>&lt;&lt;doc/generated/birds_512x341.png             original        &gt;&gt;
<a name="line-195"></a>&lt;&lt;doc/generated/examples/warpAffineImg.png    warpAffineImg   &gt;&gt;
<a name="line-196"></a>&lt;&lt;doc/generated/examples/warpAffineInvImg.png warpAffineInvImg&gt;&gt;
<a name="line-197"></a>
<a name="line-198"></a>&lt;<a href="http://docs.opencv.org/3.0-last-rst/modules/imgproc/doc/geometric_transformations.html#warpaffine">http://docs.opencv.org/3.0-last-rst/modules/imgproc/doc/geometric_transformations.html#warpaffine</a> OpenCV Sphinx doc&gt;
<a name="line-199"></a>-}</span>
<a name="line-200"></a><span class='hs-definition'>warpAffine</span>
<a name="line-201"></a>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Mat</span> <span class='hs-layout'>(</span><span class='hs-chr'>'</span><span class='hs-conid'>S</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>height</span><span class='hs-layout'>,</span> <span class='hs-varid'>width</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-varid'>channels</span> <span class='hs-varid'>depth</span> <span class='hs-comment'>-- ^ Source image.</span>
<a name="line-202"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Mat</span> <span class='hs-layout'>(</span><span class='hs-conid'>ShapeT</span> <span class='hs-keyglyph'>[</span><span class='hs-num'>2</span><span class='hs-layout'>,</span> <span class='hs-num'>3</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-chr'>'</span><span class='hs-conid'>S</span> <span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-chr'>'</span><span class='hs-conid'>S</span> <span class='hs-conid'>Double</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- ^ Affine transformation matrix.</span>
<a name="line-203"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>InterpolationMethod</span>
<a name="line-204"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span> <span class='hs-comment'>-- ^ Perform the inverse transformation.</span>
<a name="line-205"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span> <span class='hs-comment'>-- ^ Fill outliers.</span>
<a name="line-206"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>BorderMode</span> <span class='hs-comment'>-- ^ Pixel extrapolation method.</span>
<a name="line-207"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CvExcept</span> <span class='hs-layout'>(</span><span class='hs-conid'>Mat</span> <span class='hs-layout'>(</span><span class='hs-chr'>'</span><span class='hs-conid'>S</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>height</span><span class='hs-layout'>,</span> <span class='hs-varid'>width</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-varid'>channels</span> <span class='hs-varid'>depth</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- ^ Transformed source image.</span>
<a name="line-208"></a><span class='hs-definition'>warpAffine</span> <span class='hs-varid'>src</span> <span class='hs-varid'>transform</span> <span class='hs-varid'>interpolationMethod</span> <span class='hs-varid'>inverse</span> <span class='hs-varid'>fillOutliers</span> <span class='hs-varid'>borderMode</span> <span class='hs-keyglyph'>=</span>
<a name="line-209"></a>    <span class='hs-varid'>unsafeWrapException</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-210"></a>      <span class='hs-varid'>dst</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>newEmptyMat</span>
<a name="line-211"></a>      <span class='hs-varid'>handleCvException</span> <span class='hs-layout'>(</span><span class='hs-varid'>pure</span> <span class='hs-varop'>$</span> <span class='hs-varid'>unsafeCoerceMat</span> <span class='hs-varid'>dst</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span>
<a name="line-212"></a>        <span class='hs-varid'>withPtr</span> <span class='hs-varid'>src</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>srcPtr</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-213"></a>        <span class='hs-varid'>withPtr</span> <span class='hs-varid'>dst</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>dstPtr</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-214"></a>        <span class='hs-varid'>withPtr</span> <span class='hs-varid'>transform</span>   <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>transformPtr</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-215"></a>        <span class='hs-varid'>withPtr</span>    <span class='hs-varid'>borderValue</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>borderValuePtr</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-216"></a>          <span class='hs-keyglyph'>[</span><span class='hs-varid'>cvExcept</span><span class='hs-keyglyph'>|</span>
<a name="line-217"></a>            <span class='hs-conid'>Mat</span> <span class='hs-varop'>*</span> <span class='hs-varid'>src</span> <span class='hs-keyglyph'>=</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-conid'>Mat</span> <span class='hs-varop'>*</span> <span class='hs-varid'>srcPtr</span><span class='hs-layout'>)</span><span class='hs-layout'>;</span>
<a name="line-218"></a>            <span class='hs-varid'>cv</span><span class='hs-keyglyph'>::</span><span class='hs-varid'>warpAffine</span>
<a name="line-219"></a>              <span class='hs-layout'>(</span> <span class='hs-varop'>*</span><span class='hs-varid'>src</span>
<a name="line-220"></a>              <span class='hs-layout'>,</span> <span class='hs-varop'>*$</span><span class='hs-layout'>(</span><span class='hs-conid'>Mat</span> <span class='hs-varop'>*</span> <span class='hs-varid'>dstPtr</span><span class='hs-layout'>)</span>
<a name="line-221"></a>              <span class='hs-layout'>,</span> <span class='hs-varop'>*$</span><span class='hs-layout'>(</span><span class='hs-conid'>Mat</span> <span class='hs-varop'>*</span> <span class='hs-varid'>transformPtr</span><span class='hs-layout'>)</span>
<a name="line-222"></a>              <span class='hs-layout'>,</span> <span class='hs-varid'>src</span><span class='hs-keyglyph'>-&gt;</span><span class='hs-varid'>size</span><span class='hs-conid'>()</span>
<a name="line-223"></a>              <span class='hs-layout'>,</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>int32_t</span> <span class='hs-varid'>c'interpolationMethod</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>int32_t</span> <span class='hs-varid'>c'inverse</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>int32_t</span> <span class='hs-varid'>c'fillOutliers</span><span class='hs-layout'>)</span>
<a name="line-224"></a>              <span class='hs-layout'>,</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>int32_t</span> <span class='hs-varid'>c'borderMode</span><span class='hs-layout'>)</span>
<a name="line-225"></a>              <span class='hs-layout'>,</span> <span class='hs-varop'>*$</span><span class='hs-layout'>(</span><span class='hs-conid'>Scalar</span> <span class='hs-varop'>*</span> <span class='hs-varid'>borderValuePtr</span><span class='hs-layout'>)</span>
<a name="line-226"></a>              <span class='hs-layout'>)</span><span class='hs-layout'>;</span>
<a name="line-227"></a>          <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-228"></a>  <span class='hs-keyword'>where</span>
<a name="line-229"></a>    <span class='hs-varid'>c'interpolationMethod</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>marshalInterpolationMethod</span> <span class='hs-varid'>interpolationMethod</span>
<a name="line-230"></a>    <span class='hs-varid'>c'inverse</span>      <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>inverse</span>      <span class='hs-keyword'>then</span> <span class='hs-varid'>c'WARP_INVERSE_MAP</span>   <span class='hs-keyword'>else</span> <span class='hs-num'>0</span>
<a name="line-231"></a>    <span class='hs-varid'>c'fillOutliers</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>fillOutliers</span> <span class='hs-keyword'>then</span> <span class='hs-varid'>c'WARP_FILL_OUTLIERS</span> <span class='hs-keyword'>else</span> <span class='hs-num'>0</span>
<a name="line-232"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>c'borderMode</span><span class='hs-layout'>,</span> <span class='hs-varid'>borderValue</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>marshalBorderMode</span> <span class='hs-varid'>borderMode</span>
<a name="line-233"></a>
<a name="line-234"></a><a name="warpPerspective"></a><span class='hs-comment'>-- | Applies a perspective transformation to an image</span>
<a name="line-235"></a><span class='hs-comment'>--</span>
<a name="line-236"></a><span class='hs-comment'>-- &lt;<a href="http://docs.opencv.org/3.0-last-rst/modules/imgproc/doc/geometric_transformations.html#warpperspective">http://docs.opencv.org/3.0-last-rst/modules/imgproc/doc/geometric_transformations.html#warpperspective</a> OpenCV Sphinx doc&gt;</span>
<a name="line-237"></a><span class='hs-definition'>warpPerspective</span>
<a name="line-238"></a>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Mat</span> <span class='hs-layout'>(</span><span class='hs-chr'>'</span><span class='hs-conid'>S</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>height</span><span class='hs-layout'>,</span> <span class='hs-varid'>width</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-varid'>channels</span> <span class='hs-varid'>depth</span> <span class='hs-comment'>-- ^ Source image.</span>
<a name="line-239"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Mat</span> <span class='hs-layout'>(</span><span class='hs-conid'>ShapeT</span> <span class='hs-keyglyph'>[</span><span class='hs-num'>3</span><span class='hs-layout'>,</span> <span class='hs-num'>3</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-chr'>'</span><span class='hs-conid'>S</span> <span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-chr'>'</span><span class='hs-conid'>S</span> <span class='hs-conid'>Double</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- ^ Perspective transformation matrix.</span>
<a name="line-240"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>InterpolationMethod</span>
<a name="line-241"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span> <span class='hs-comment'>-- ^ Perform the inverse transformation.</span>
<a name="line-242"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span> <span class='hs-comment'>-- ^ Fill outliers.</span>
<a name="line-243"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>BorderMode</span> <span class='hs-comment'>-- ^ Pixel extrapolation method.</span>
<a name="line-244"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CvExcept</span> <span class='hs-layout'>(</span><span class='hs-conid'>Mat</span> <span class='hs-layout'>(</span><span class='hs-chr'>'</span><span class='hs-conid'>S</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>height</span><span class='hs-layout'>,</span> <span class='hs-varid'>width</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-varid'>channels</span> <span class='hs-varid'>depth</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- ^ Transformed source image.</span>
<a name="line-245"></a><span class='hs-definition'>warpPerspective</span> <span class='hs-varid'>src</span> <span class='hs-varid'>transform</span> <span class='hs-varid'>interpolationMethod</span> <span class='hs-varid'>inverse</span> <span class='hs-varid'>fillOutliers</span> <span class='hs-varid'>borderMode</span> <span class='hs-keyglyph'>=</span>
<a name="line-246"></a>    <span class='hs-varid'>unsafeWrapException</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-247"></a>      <span class='hs-varid'>dst</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>newEmptyMat</span>
<a name="line-248"></a>      <span class='hs-varid'>handleCvException</span> <span class='hs-layout'>(</span><span class='hs-varid'>pure</span> <span class='hs-varop'>$</span> <span class='hs-varid'>unsafeCoerceMat</span> <span class='hs-varid'>dst</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span>
<a name="line-249"></a>        <span class='hs-varid'>withPtr</span> <span class='hs-varid'>src</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>srcPtr</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-250"></a>        <span class='hs-varid'>withPtr</span> <span class='hs-varid'>dst</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>dstPtr</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-251"></a>        <span class='hs-varid'>withPtr</span> <span class='hs-varid'>transform</span>   <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>transformPtr</span>   <span class='hs-keyglyph'>-&gt;</span>
<a name="line-252"></a>        <span class='hs-varid'>withPtr</span>    <span class='hs-varid'>borderValue</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>borderValuePtr</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-253"></a>          <span class='hs-keyglyph'>[</span><span class='hs-varid'>cvExcept</span><span class='hs-keyglyph'>|</span>
<a name="line-254"></a>            <span class='hs-conid'>Mat</span> <span class='hs-varop'>*</span> <span class='hs-varid'>src</span> <span class='hs-keyglyph'>=</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-conid'>Mat</span> <span class='hs-varop'>*</span> <span class='hs-varid'>srcPtr</span><span class='hs-layout'>)</span><span class='hs-layout'>;</span>
<a name="line-255"></a>            <span class='hs-varid'>cv</span><span class='hs-keyglyph'>::</span><span class='hs-varid'>warpPerspective</span>
<a name="line-256"></a>              <span class='hs-layout'>(</span> <span class='hs-varop'>*</span><span class='hs-varid'>src</span>
<a name="line-257"></a>              <span class='hs-layout'>,</span> <span class='hs-varop'>*$</span><span class='hs-layout'>(</span><span class='hs-conid'>Mat</span> <span class='hs-varop'>*</span> <span class='hs-varid'>dstPtr</span><span class='hs-layout'>)</span>
<a name="line-258"></a>              <span class='hs-layout'>,</span> <span class='hs-varop'>*$</span><span class='hs-layout'>(</span><span class='hs-conid'>Mat</span> <span class='hs-varop'>*</span> <span class='hs-varid'>transformPtr</span><span class='hs-layout'>)</span>
<a name="line-259"></a>              <span class='hs-layout'>,</span> <span class='hs-varid'>src</span><span class='hs-keyglyph'>-&gt;</span><span class='hs-varid'>size</span><span class='hs-conid'>()</span>
<a name="line-260"></a>              <span class='hs-layout'>,</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>int32_t</span> <span class='hs-varid'>c'interpolationMethod</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>int32_t</span> <span class='hs-varid'>c'inverse</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>int32_t</span> <span class='hs-varid'>c'fillOutliers</span><span class='hs-layout'>)</span>
<a name="line-261"></a>              <span class='hs-layout'>,</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>int32_t</span> <span class='hs-varid'>c'borderMode</span><span class='hs-layout'>)</span>
<a name="line-262"></a>              <span class='hs-layout'>,</span> <span class='hs-varop'>*$</span><span class='hs-layout'>(</span><span class='hs-conid'>Scalar</span> <span class='hs-varop'>*</span> <span class='hs-varid'>borderValuePtr</span><span class='hs-layout'>)</span>
<a name="line-263"></a>              <span class='hs-layout'>)</span><span class='hs-layout'>;</span>
<a name="line-264"></a>          <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-265"></a>  <span class='hs-keyword'>where</span>
<a name="line-266"></a>    <span class='hs-varid'>c'interpolationMethod</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>marshalInterpolationMethod</span> <span class='hs-varid'>interpolationMethod</span>
<a name="line-267"></a>    <span class='hs-varid'>c'inverse</span>      <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>inverse</span>      <span class='hs-keyword'>then</span> <span class='hs-varid'>c'WARP_INVERSE_MAP</span>   <span class='hs-keyword'>else</span> <span class='hs-num'>0</span>
<a name="line-268"></a>    <span class='hs-varid'>c'fillOutliers</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>fillOutliers</span> <span class='hs-keyword'>then</span> <span class='hs-varid'>c'WARP_FILL_OUTLIERS</span> <span class='hs-keyword'>else</span> <span class='hs-num'>0</span>
<a name="line-269"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>c'borderMode</span><span class='hs-layout'>,</span> <span class='hs-varid'>borderValue</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>marshalBorderMode</span> <span class='hs-varid'>borderMode</span>
<a name="line-270"></a>
<a name="line-271"></a><a name="invertAffineTransform"></a><span class='hs-comment'>-- | Inverts an affine transformation</span>
<a name="line-272"></a><span class='hs-comment'>--</span>
<a name="line-273"></a><span class='hs-comment'>-- &lt;<a href="http://docs.opencv.org/3.0-last-rst/modules/imgproc/doc/geometric_transformations.html#invertaffinetransform">http://docs.opencv.org/3.0-last-rst/modules/imgproc/doc/geometric_transformations.html#invertaffinetransform</a> OpenCV Sphinx doc&gt;</span>
<a name="line-274"></a><span class='hs-definition'>invertAffineTransform</span>
<a name="line-275"></a>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Mat</span> <span class='hs-layout'>(</span><span class='hs-conid'>ShapeT</span> <span class='hs-keyglyph'>[</span><span class='hs-num'>2</span><span class='hs-layout'>,</span> <span class='hs-num'>3</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-chr'>'</span><span class='hs-conid'>S</span> <span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-varid'>depth</span> <span class='hs-comment'>-- ^</span>
<a name="line-276"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CvExcept</span> <span class='hs-layout'>(</span><span class='hs-conid'>Mat</span> <span class='hs-layout'>(</span><span class='hs-conid'>ShapeT</span> <span class='hs-keyglyph'>[</span><span class='hs-num'>2</span><span class='hs-layout'>,</span> <span class='hs-num'>3</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-chr'>'</span><span class='hs-conid'>S</span> <span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-varid'>depth</span><span class='hs-layout'>)</span>
<a name="line-277"></a><span class='hs-definition'>invertAffineTransform</span> <span class='hs-varid'>matIn</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unsafeWrapException</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-278"></a>    <span class='hs-varid'>matOut</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>newEmptyMat</span>
<a name="line-279"></a>    <span class='hs-varid'>handleCvException</span> <span class='hs-layout'>(</span><span class='hs-varid'>pure</span> <span class='hs-varop'>$</span> <span class='hs-varid'>unsafeCoerceMat</span> <span class='hs-varid'>matOut</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span>
<a name="line-280"></a>      <span class='hs-varid'>withPtr</span> <span class='hs-varid'>matIn</span>  <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>matInPtr</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-281"></a>      <span class='hs-varid'>withPtr</span> <span class='hs-varid'>matOut</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>matOutPtr</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-282"></a>        <span class='hs-keyglyph'>[</span><span class='hs-varid'>cvExcept</span><span class='hs-keyglyph'>|</span>
<a name="line-283"></a>           <span class='hs-varid'>cv</span><span class='hs-keyglyph'>::</span><span class='hs-varid'>invertAffineTransform</span><span class='hs-layout'>(</span><span class='hs-varop'>*$</span><span class='hs-layout'>(</span><span class='hs-conid'>Mat</span> <span class='hs-varop'>*</span> <span class='hs-varid'>matInPtr</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varop'>*$</span><span class='hs-layout'>(</span><span class='hs-conid'>Mat</span> <span class='hs-varop'>*</span> <span class='hs-varid'>matOutPtr</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>;</span>
<a name="line-284"></a>        <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-285"></a>
<a name="line-286"></a><a name="getRotationMatrix2D"></a><span class='hs-comment'>{- | Calculates an affine matrix of 2D rotation
<a name="line-287"></a>
<a name="line-288"></a>&lt;<a href="http://docs.opencv.org/3.0-last-rst/modules/imgproc/doc/geometric_transformations.html#getrotationmatrix2d">http://docs.opencv.org/3.0-last-rst/modules/imgproc/doc/geometric_transformations.html#getrotationmatrix2d</a> OpenCV Sphinx doc&gt;
<a name="line-289"></a>-}</span>
<a name="line-290"></a><span class='hs-definition'>getRotationMatrix2D</span>
<a name="line-291"></a>    <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>IsPoint2</span> <span class='hs-varid'>point2</span> <span class='hs-conid'>CFloat</span><span class='hs-layout'>)</span>
<a name="line-292"></a>    <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>point2</span> <span class='hs-conid'>CFloat</span> <span class='hs-comment'>-- ^ Center of the rotation in the source image.</span>
<a name="line-293"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Double</span>
<a name="line-294"></a>       <span class='hs-comment'>-- ^ Rotation angle in degrees. Positive values mean counter-clockwise</span>
<a name="line-295"></a>       <span class='hs-comment'>-- rotation (the coordinate origin is assumed to be the top-left corner).</span>
<a name="line-296"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Double</span> <span class='hs-comment'>-- ^ Isotropic scale factor.</span>
<a name="line-297"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Mat</span> <span class='hs-layout'>(</span><span class='hs-conid'>ShapeT</span> <span class='hs-keyglyph'>[</span><span class='hs-num'>2</span><span class='hs-layout'>,</span> <span class='hs-num'>3</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-chr'>'</span><span class='hs-conid'>S</span> <span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-chr'>'</span><span class='hs-conid'>S</span> <span class='hs-conid'>Double</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- ^ The output affine transformation, 2x3 floating-point matrix.</span>
<a name="line-298"></a><span class='hs-definition'>getRotationMatrix2D</span> <span class='hs-varid'>center</span> <span class='hs-varid'>angle</span> <span class='hs-varid'>scale</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unsafeCoerceMat</span> <span class='hs-varop'>$</span> <span class='hs-varid'>unsafePerformIO</span> <span class='hs-varop'>$</span>
<a name="line-299"></a>    <span class='hs-varid'>withPtr</span> <span class='hs-layout'>(</span><span class='hs-varid'>toPoint</span> <span class='hs-varid'>center</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>centerPtr</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-300"></a>      <span class='hs-varid'>fromPtr</span>
<a name="line-301"></a>      <span class='hs-keyglyph'>[</span><span class='hs-conid'>CU</span><span class='hs-varop'>.</span><span class='hs-varid'>block</span><span class='hs-keyglyph'>|</span> <span class='hs-conid'>Mat</span> <span class='hs-varop'>*</span> <span class='hs-layout'>{</span>
<a name="line-302"></a>        <span class='hs-varid'>return</span> <span class='hs-varid'>new</span> <span class='hs-varid'>cv</span><span class='hs-keyglyph'>::</span><span class='hs-conid'>Mat</span>
<a name="line-303"></a>        <span class='hs-layout'>(</span> <span class='hs-varid'>cv</span><span class='hs-keyglyph'>::</span><span class='hs-varid'>getRotationMatrix2D</span>
<a name="line-304"></a>          <span class='hs-layout'>(</span> <span class='hs-varop'>*$</span><span class='hs-layout'>(</span><span class='hs-conid'>Point2f</span> <span class='hs-varop'>*</span> <span class='hs-varid'>centerPtr</span><span class='hs-layout'>)</span>
<a name="line-305"></a>          <span class='hs-layout'>,</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>double</span> <span class='hs-varid'>c'angle</span><span class='hs-layout'>)</span>
<a name="line-306"></a>          <span class='hs-layout'>,</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>double</span> <span class='hs-varid'>c'scale</span><span class='hs-layout'>)</span>
<a name="line-307"></a>          <span class='hs-layout'>)</span>
<a name="line-308"></a>        <span class='hs-layout'>)</span><span class='hs-layout'>;</span>
<a name="line-309"></a>      <span class='hs-layout'>}</span><span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-310"></a>  <span class='hs-keyword'>where</span>
<a name="line-311"></a>    <span class='hs-varid'>c'angle</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>realToFrac</span> <span class='hs-varid'>angle</span>
<a name="line-312"></a>    <span class='hs-varid'>c'scale</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>realToFrac</span> <span class='hs-varid'>scale</span>
<a name="line-313"></a>
<a name="line-314"></a><a name="remap"></a><span class='hs-comment'>{- | Applies a generic geometrical transformation to an image.
<a name="line-315"></a>
<a name="line-316"></a>The function remap transforms the source image using the specified map:
<a name="line-317"></a>
<a name="line-318"></a>@dst(x,y) = src(map(x,y))@
<a name="line-319"></a>
<a name="line-320"></a>Example:
<a name="line-321"></a>
<a name="line-322"></a>@
<a name="line-323"></a>remapImg
<a name="line-324"></a>  :: forall (width    :: Nat)
<a name="line-325"></a>            (height   :: Nat)
<a name="line-326"></a>            (channels :: Nat)
<a name="line-327"></a>            (depth    :: *  )
<a name="line-328"></a>   . (Mat ('S ['S height, 'S width]) ('S channels) ('S depth) ~ Birds_512x341)
<a name="line-329"></a>  =&gt; Mat ('S ['S height, 'S width]) ('S channels) ('S depth)
<a name="line-330"></a>remapImg = exceptError $ remap birds_512x341 transform InterLinear (BorderConstant black)
<a name="line-331"></a>  where
<a name="line-332"></a>    transform = exceptError $
<a name="line-333"></a>                matFromFunc (Proxy :: Proxy [height, width])
<a name="line-334"></a>                            (Proxy :: Proxy 2)
<a name="line-335"></a>                            (Proxy :: Proxy Float)
<a name="line-336"></a>                            exampleFunc
<a name="line-337"></a>
<a name="line-338"></a>    exampleFunc [_y,  x] 0 = wobble x w
<a name="line-339"></a>    exampleFunc [ y, _x] 1 = wobble y h
<a name="line-340"></a>    exampleFunc _pos _channel = error "impossible"
<a name="line-341"></a>
<a name="line-342"></a>    wobble :: Int -&gt; Float -&gt; Float
<a name="line-343"></a>    wobble v s = let v' = fromIntegral v
<a name="line-344"></a>                     n = v' / s
<a name="line-345"></a>                 in v' + (s * 0.05 * sin (n * 2 * pi * 5))
<a name="line-346"></a>
<a name="line-347"></a>    w = fromInteger $ natVal (Proxy :: Proxy width)
<a name="line-348"></a>    h = fromInteger $ natVal (Proxy :: Proxy height)
<a name="line-349"></a>@
<a name="line-350"></a>
<a name="line-351"></a>&lt;&lt;doc/generated/birds_512x341.png original&gt;&gt;
<a name="line-352"></a>&lt;&lt;doc/generated/examples/remapImg.png remapImg&gt;&gt;
<a name="line-353"></a>
<a name="line-354"></a>&lt;<a href="http://docs.opencv.org/3.0-last-rst/modules/imgproc/doc/geometric_transformations.html#remap">http://docs.opencv.org/3.0-last-rst/modules/imgproc/doc/geometric_transformations.html#remap</a> OpenCV documentation&gt;
<a name="line-355"></a>-}</span>
<a name="line-356"></a><span class='hs-definition'>remap</span>
<a name="line-357"></a>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Mat</span> <span class='hs-layout'>(</span><span class='hs-chr'>'</span><span class='hs-conid'>S</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>inputHeight</span><span class='hs-layout'>,</span> <span class='hs-varid'>inputWidth</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-varid'>inputChannels</span> <span class='hs-varid'>inputDepth</span>
<a name="line-358"></a>       <span class='hs-comment'>-- ^ Source image.</span>
<a name="line-359"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Mat</span> <span class='hs-layout'>(</span><span class='hs-chr'>'</span><span class='hs-conid'>S</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>outputHeight</span><span class='hs-layout'>,</span> <span class='hs-varid'>outputWidth</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-chr'>'</span><span class='hs-conid'>S</span> <span class='hs-num'>2</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-chr'>'</span><span class='hs-conid'>S</span> <span class='hs-conid'>Float</span><span class='hs-layout'>)</span>
<a name="line-360"></a>       <span class='hs-comment'>-- ^ A map of @(x, y)@ points.</span>
<a name="line-361"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>InterpolationMethod</span>
<a name="line-362"></a>       <span class='hs-comment'>-- ^ Interpolation method to use. Note that 'InterArea' is not</span>
<a name="line-363"></a>       <span class='hs-comment'>-- supported by this function.</span>
<a name="line-364"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>BorderMode</span>
<a name="line-365"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CvExcept</span> <span class='hs-layout'>(</span><span class='hs-conid'>Mat</span> <span class='hs-layout'>(</span><span class='hs-chr'>'</span><span class='hs-conid'>S</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>outputHeight</span><span class='hs-layout'>,</span> <span class='hs-varid'>outputWidth</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-varid'>inputChannels</span> <span class='hs-varid'>inputDepth</span><span class='hs-layout'>)</span>
<a name="line-366"></a><span class='hs-definition'>remap</span> <span class='hs-varid'>src</span> <span class='hs-varid'>mapping</span> <span class='hs-varid'>interpolationMethod</span> <span class='hs-varid'>borderMode</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unsafeWrapException</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-367"></a>    <span class='hs-varid'>dst</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>newEmptyMat</span>
<a name="line-368"></a>    <span class='hs-varid'>handleCvException</span> <span class='hs-layout'>(</span><span class='hs-varid'>pure</span> <span class='hs-varop'>$</span> <span class='hs-varid'>unsafeCoerceMat</span> <span class='hs-varid'>dst</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span>
<a name="line-369"></a>      <span class='hs-varid'>withPtr</span> <span class='hs-varid'>src</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>srcPtr</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-370"></a>      <span class='hs-varid'>withPtr</span> <span class='hs-varid'>dst</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>dstPtr</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-371"></a>      <span class='hs-varid'>withPtr</span> <span class='hs-varid'>mapping</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>mappingPtr</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-372"></a>      <span class='hs-varid'>withPtr</span> <span class='hs-varid'>borderValue</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>borderValuePtr</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-373"></a>        <span class='hs-keyglyph'>[</span><span class='hs-varid'>cvExcept</span><span class='hs-keyglyph'>|</span>
<a name="line-374"></a>          <span class='hs-varid'>cv</span><span class='hs-keyglyph'>::</span><span class='hs-varid'>remap</span>
<a name="line-375"></a>            <span class='hs-layout'>(</span> <span class='hs-varop'>*$</span><span class='hs-layout'>(</span><span class='hs-conid'>Mat</span> <span class='hs-varop'>*</span> <span class='hs-varid'>srcPtr</span><span class='hs-layout'>)</span>
<a name="line-376"></a>            <span class='hs-layout'>,</span> <span class='hs-varop'>*$</span><span class='hs-layout'>(</span><span class='hs-conid'>Mat</span> <span class='hs-varop'>*</span> <span class='hs-varid'>dstPtr</span><span class='hs-layout'>)</span>
<a name="line-377"></a>            <span class='hs-layout'>,</span> <span class='hs-varop'>*$</span><span class='hs-layout'>(</span><span class='hs-conid'>Mat</span> <span class='hs-varop'>*</span> <span class='hs-varid'>mappingPtr</span><span class='hs-layout'>)</span>
<a name="line-378"></a>            <span class='hs-layout'>,</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span>
<a name="line-379"></a>            <span class='hs-layout'>,</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>int32_t</span> <span class='hs-varid'>c'interpolation</span><span class='hs-layout'>)</span>
<a name="line-380"></a>            <span class='hs-layout'>,</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>int32_t</span> <span class='hs-varid'>c'borderMode</span><span class='hs-layout'>)</span>
<a name="line-381"></a>            <span class='hs-layout'>,</span> <span class='hs-varop'>*$</span><span class='hs-layout'>(</span><span class='hs-conid'>Scalar</span> <span class='hs-varop'>*</span> <span class='hs-varid'>borderValuePtr</span><span class='hs-layout'>)</span>
<a name="line-382"></a>            <span class='hs-layout'>)</span><span class='hs-layout'>;</span>
<a name="line-383"></a>        <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-384"></a>  <span class='hs-keyword'>where</span>
<a name="line-385"></a>    <span class='hs-varid'>c'interpolation</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>marshalInterpolationMethod</span> <span class='hs-varid'>interpolationMethod</span>
<a name="line-386"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>c'borderMode</span><span class='hs-layout'>,</span> <span class='hs-varid'>borderValue</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>marshalBorderMode</span> <span class='hs-varid'>borderMode</span>
</pre></body>
</html>
