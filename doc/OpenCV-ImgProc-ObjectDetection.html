<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>OpenCV.ImgProc.ObjectDetection</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/OpenCV-ImgProc-ObjectDetection.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">opencv-0.0.2.1: Haskell binding to OpenCV-3.x</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">OpenCV.ImgProc.ObjectDetection</p></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><span class="keyword">data</span> <a href="#t:MatchTemplateMethod">MatchTemplateMethod</a><ul class="subs"><li>= <a href="#v:MatchTemplateSqDiff">MatchTemplateSqDiff</a></li><li>| <a href="#v:MatchTemplateCCorr">MatchTemplateCCorr</a></li><li>| <a href="#v:MatchTemplateCCoeff">MatchTemplateCCoeff</a></li></ul></li><li class="src short"><span class="keyword">data</span> <a href="#t:MatchTemplateNormalisation">MatchTemplateNormalisation</a><ul class="subs"><li>= <a href="#v:MatchTemplateNotNormed">MatchTemplateNotNormed</a></li><li>| <a href="#v:MatchTemplateNormed">MatchTemplateNormed</a></li></ul></li><li class="src short"><a href="#v:matchTemplate">matchTemplate</a> :: depth <a href="OpenCV-TypeLevel.html#t:In">`In`</a> [<a href="file:///nix/store/cvd8q905vz2dx3jjyq8c5lx0bcrbknmi-ghc-8.2.2-doc/share/doc/ghc/html/libraries/base-4.10.1.0/Data-Word.html#t:Word8">Word8</a>, <a href="file:///nix/store/cvd8q905vz2dx3jjyq8c5lx0bcrbknmi-ghc-8.2.2-doc/share/doc/ghc/html/libraries/base-4.10.1.0/Prelude.html#t:Float">Float</a>] =&gt; <a href="OpenCV-Core-Types-Mat.html#t:Mat">Mat</a> (<a href="OpenCV-TypeLevel.html#v:S">S</a> [sh, sw]) (<a href="OpenCV-TypeLevel.html#v:S">S</a> channels) (<a href="OpenCV-TypeLevel.html#v:S">S</a> depth) -&gt; <a href="OpenCV-Core-Types-Mat.html#t:Mat">Mat</a> (<a href="OpenCV-TypeLevel.html#v:S">S</a> [th, tw]) (<a href="OpenCV-TypeLevel.html#v:S">S</a> channels) (<a href="OpenCV-TypeLevel.html#v:S">S</a> depth) -&gt; <a href="OpenCV-ImgProc-ObjectDetection.html#t:MatchTemplateMethod">MatchTemplateMethod</a> -&gt; <a href="OpenCV-ImgProc-ObjectDetection.html#t:MatchTemplateNormalisation">MatchTemplateNormalisation</a> -&gt; <a href="OpenCV-Exception.html#t:CvExcept">CvExcept</a> (<a href="OpenCV-Core-Types-Mat.html#t:Mat">Mat</a> (<a href="OpenCV-TypeLevel.html#v:S">S</a> [rh, rw]) (<a href="OpenCV-TypeLevel.html#v:S">S</a> 1) (<a href="OpenCV-TypeLevel.html#v:S">S</a> <a href="file:///nix/store/cvd8q905vz2dx3jjyq8c5lx0bcrbknmi-ghc-8.2.2-doc/share/doc/ghc/html/libraries/base-4.10.1.0/Prelude.html#t:Float">Float</a>))</li></ul></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:MatchTemplateMethod" class="def">MatchTemplateMethod</a> <a href="src/OpenCV-ImgProc-ObjectDetection.html#MatchTemplateMethod" class="link">Source</a> <a href="#t:MatchTemplateMethod" class="selflink">#</a></p><div class="doc"><p>Type of the template matching operation</p><p>In the formulae for the comparison methods \(\bf{I}\) denotes image,
 \(\bf{T}\) template and \(\bf{R}\) result. Each method supports
 normalization. See <code><a href="OpenCV-ImgProc-ObjectDetection.html#t:MatchTemplateNormalisation">MatchTemplateNormalisation</a></code>.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:MatchTemplateSqDiff" class="def">MatchTemplateSqDiff</a></td><td class="doc"><ul><li>not normed:
           \[
           R(x,y) = \sum _{x',y'} (T(x',y')-I(x+x',y+y'))^2
           \]</li><li>normed:
           \[
           R(x,y) = \frac{\sum_{x',y'} (T(x',y')-I(x+x',y+y'))^2}
                         {\sqrt{\sum_{x',y'}T(x',y')^2 \cdot \sum_{x',y'} I(x+x',y+y')^2}}
           \]</li></ul></td></tr><tr><td class="src"><a id="v:MatchTemplateCCorr" class="def">MatchTemplateCCorr</a></td><td class="doc"><ul><li>not normed:
           \[
           R(x,y) = \sum _{x',y'} (T(x',y')  \cdot I(x+x',y+y'))
           \]</li><li>normed:
           \[
           R(x,y) = \frac{\sum_{x',y'} (T(x',y') \cdot I(x+x',y+y'))}
                         {\sqrt{\sum_{x',y'}T(x',y')^2 \cdot \sum_{x',y'} I(x+x',y+y')^2}}
           \]</li></ul></td></tr><tr><td class="src"><a id="v:MatchTemplateCCoeff" class="def">MatchTemplateCCoeff</a></td><td class="doc"><ul><li>not normed:
           \[
           R(x,y) = \sum _{x',y'} (T'(x',y') \cdot I'(x+x',y+y'))
           \]</li><li>where
           \[ \begin{array}{l}
           T'(x',y') = T(x',y') - 1/(w \cdot h) \cdot \sum _{x'',y''} T(x'',y'')
           \\ I'(x+x',y+y') = I(x+x',y+y') - 1/(w \cdot h) \cdot \sum _{x'',y''} I(x+x'',y+y'')
           \end{array} \]</li><li>normed:
           \[
           R(x,y) = \frac{ \sum_{x',y'} (T'(x',y') \cdot I'(x+x',y+y')) }
                         { \sqrt{\sum_{x',y'}T'(x',y')^2 \cdot \sum_{x',y'} I'(x+x',y+y')^2} }
           \]</li></ul></td></tr></table></div><div class="subs instances"><p id="control.i:MatchTemplateMethod" class="caption collapser" onclick="toggleSection('i:MatchTemplateMethod')">Instances</p><div id="section.i:MatchTemplateMethod" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:id:MatchTemplateMethod:Show:1" class="instance expander" onclick="toggleSection('i:id:MatchTemplateMethod:Show:1')"></span> <a href="file:///nix/store/cvd8q905vz2dx3jjyq8c5lx0bcrbknmi-ghc-8.2.2-doc/share/doc/ghc/html/libraries/base-4.10.1.0/Text-Show.html#t:Show">Show</a> <a href="OpenCV-ImgProc-ObjectDetection.html#t:MatchTemplateMethod">MatchTemplateMethod</a></span> <a href="src/OpenCV-ImgProc-ObjectDetection.html#line-95" class="link">Source</a> <a href="#t:MatchTemplateMethod" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:id:MatchTemplateMethod:Show:1" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: <a href="file:///nix/store/cvd8q905vz2dx3jjyq8c5lx0bcrbknmi-ghc-8.2.2-doc/share/doc/ghc/html/libraries/base-4.10.1.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="OpenCV-ImgProc-ObjectDetection.html#t:MatchTemplateMethod">MatchTemplateMethod</a> -&gt; <a href="file:///nix/store/cvd8q905vz2dx3jjyq8c5lx0bcrbknmi-ghc-8.2.2-doc/share/doc/ghc/html/libraries/base-4.10.1.0/Text-Show.html#t:ShowS">ShowS</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> :: <a href="OpenCV-ImgProc-ObjectDetection.html#t:MatchTemplateMethod">MatchTemplateMethod</a> -&gt; <a href="file:///nix/store/cvd8q905vz2dx3jjyq8c5lx0bcrbknmi-ghc-8.2.2-doc/share/doc/ghc/html/libraries/base-4.10.1.0/Data-String.html#t:String">String</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> :: [<a href="OpenCV-ImgProc-ObjectDetection.html#t:MatchTemplateMethod">MatchTemplateMethod</a>] -&gt; <a href="file:///nix/store/cvd8q905vz2dx3jjyq8c5lx0bcrbknmi-ghc-8.2.2-doc/share/doc/ghc/html/libraries/base-4.10.1.0/Text-Show.html#t:ShowS">ShowS</a> <a href="#v:showList" class="selflink">#</a></p></div></div></td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:MatchTemplateNormalisation" class="def">MatchTemplateNormalisation</a> <a href="src/OpenCV-ImgProc-ObjectDetection.html#MatchTemplateNormalisation" class="link">Source</a> <a href="#t:MatchTemplateNormalisation" class="selflink">#</a></p><div class="doc"><p>Whether to use normalisation. See <code><a href="OpenCV-ImgProc-ObjectDetection.html#t:MatchTemplateMethod">MatchTemplateMethod</a></code>.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:MatchTemplateNotNormed" class="def">MatchTemplateNotNormed</a></td><td class="doc"><p>Do not use normalization.</p></td></tr><tr><td class="src"><a id="v:MatchTemplateNormed" class="def">MatchTemplateNormed</a></td><td class="doc"><p>Use normalization.</p></td></tr></table></div><div class="subs instances"><p id="control.i:MatchTemplateNormalisation" class="caption collapser" onclick="toggleSection('i:MatchTemplateNormalisation')">Instances</p><div id="section.i:MatchTemplateNormalisation" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:id:MatchTemplateNormalisation:Eq:1" class="instance expander" onclick="toggleSection('i:id:MatchTemplateNormalisation:Eq:1')"></span> <a href="file:///nix/store/cvd8q905vz2dx3jjyq8c5lx0bcrbknmi-ghc-8.2.2-doc/share/doc/ghc/html/libraries/base-4.10.1.0/Data-Eq.html#t:Eq">Eq</a> <a href="OpenCV-ImgProc-ObjectDetection.html#t:MatchTemplateNormalisation">MatchTemplateNormalisation</a></span> <a href="src/OpenCV-ImgProc-ObjectDetection.html#line-101" class="link">Source</a> <a href="#t:MatchTemplateNormalisation" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:id:MatchTemplateNormalisation:Eq:1" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-61--61-">(==)</a> :: <a href="OpenCV-ImgProc-ObjectDetection.html#t:MatchTemplateNormalisation">MatchTemplateNormalisation</a> -&gt; <a href="OpenCV-ImgProc-ObjectDetection.html#t:MatchTemplateNormalisation">MatchTemplateNormalisation</a> -&gt; <a href="file:///nix/store/cvd8q905vz2dx3jjyq8c5lx0bcrbknmi-ghc-8.2.2-doc/share/doc/ghc/html/libraries/base-4.10.1.0/Data-Bool.html#t:Bool">Bool</a> <a href="#v:-61--61-" class="selflink">#</a></p><p class="src"><a href="#v:-47--61-">(/=)</a> :: <a href="OpenCV-ImgProc-ObjectDetection.html#t:MatchTemplateNormalisation">MatchTemplateNormalisation</a> -&gt; <a href="OpenCV-ImgProc-ObjectDetection.html#t:MatchTemplateNormalisation">MatchTemplateNormalisation</a> -&gt; <a href="file:///nix/store/cvd8q905vz2dx3jjyq8c5lx0bcrbknmi-ghc-8.2.2-doc/share/doc/ghc/html/libraries/base-4.10.1.0/Data-Bool.html#t:Bool">Bool</a> <a href="#v:-47--61-" class="selflink">#</a></p></div></div></td></tr><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:id:MatchTemplateNormalisation:Show:2" class="instance expander" onclick="toggleSection('i:id:MatchTemplateNormalisation:Show:2')"></span> <a href="file:///nix/store/cvd8q905vz2dx3jjyq8c5lx0bcrbknmi-ghc-8.2.2-doc/share/doc/ghc/html/libraries/base-4.10.1.0/Text-Show.html#t:Show">Show</a> <a href="OpenCV-ImgProc-ObjectDetection.html#t:MatchTemplateNormalisation">MatchTemplateNormalisation</a></span> <a href="src/OpenCV-ImgProc-ObjectDetection.html#line-101" class="link">Source</a> <a href="#t:MatchTemplateNormalisation" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:id:MatchTemplateNormalisation:Show:2" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: <a href="file:///nix/store/cvd8q905vz2dx3jjyq8c5lx0bcrbknmi-ghc-8.2.2-doc/share/doc/ghc/html/libraries/base-4.10.1.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="OpenCV-ImgProc-ObjectDetection.html#t:MatchTemplateNormalisation">MatchTemplateNormalisation</a> -&gt; <a href="file:///nix/store/cvd8q905vz2dx3jjyq8c5lx0bcrbknmi-ghc-8.2.2-doc/share/doc/ghc/html/libraries/base-4.10.1.0/Text-Show.html#t:ShowS">ShowS</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> :: <a href="OpenCV-ImgProc-ObjectDetection.html#t:MatchTemplateNormalisation">MatchTemplateNormalisation</a> -&gt; <a href="file:///nix/store/cvd8q905vz2dx3jjyq8c5lx0bcrbknmi-ghc-8.2.2-doc/share/doc/ghc/html/libraries/base-4.10.1.0/Data-String.html#t:String">String</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> :: [<a href="OpenCV-ImgProc-ObjectDetection.html#t:MatchTemplateNormalisation">MatchTemplateNormalisation</a>] -&gt; <a href="file:///nix/store/cvd8q905vz2dx3jjyq8c5lx0bcrbknmi-ghc-8.2.2-doc/share/doc/ghc/html/libraries/base-4.10.1.0/Text-Show.html#t:ShowS">ShowS</a> <a href="#v:showList" class="selflink">#</a></p></div></div></td></tr></table></div></div></div><div class="top"><p class="src"><a id="v:matchTemplate" class="def">matchTemplate</a> <a href="src/OpenCV-ImgProc-ObjectDetection.html#matchTemplate" class="link">Source</a> <a href="#v:matchTemplate" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: depth <a href="OpenCV-TypeLevel.html#t:In">`In`</a> [<a href="file:///nix/store/cvd8q905vz2dx3jjyq8c5lx0bcrbknmi-ghc-8.2.2-doc/share/doc/ghc/html/libraries/base-4.10.1.0/Data-Word.html#t:Word8">Word8</a>, <a href="file:///nix/store/cvd8q905vz2dx3jjyq8c5lx0bcrbknmi-ghc-8.2.2-doc/share/doc/ghc/html/libraries/base-4.10.1.0/Prelude.html#t:Float">Float</a>]</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="OpenCV-Core-Types-Mat.html#t:Mat">Mat</a> (<a href="OpenCV-TypeLevel.html#v:S">S</a> [sh, sw]) (<a href="OpenCV-TypeLevel.html#v:S">S</a> channels) (<a href="OpenCV-TypeLevel.html#v:S">S</a> depth)</td><td class="doc"><p>Image where the search is running. It must be 8-bit or 32-bit floating-point.</p></td></tr><tr><td class="src">-&gt; <a href="OpenCV-Core-Types-Mat.html#t:Mat">Mat</a> (<a href="OpenCV-TypeLevel.html#v:S">S</a> [th, tw]) (<a href="OpenCV-TypeLevel.html#v:S">S</a> channels) (<a href="OpenCV-TypeLevel.html#v:S">S</a> depth)</td><td class="doc"><p>Searched template. It must be not greater than the source image and have the same data type.</p></td></tr><tr><td class="src">-&gt; <a href="OpenCV-ImgProc-ObjectDetection.html#t:MatchTemplateMethod">MatchTemplateMethod</a></td><td class="doc"><p>Comparison method.</p></td></tr><tr><td class="src">-&gt; <a href="OpenCV-ImgProc-ObjectDetection.html#t:MatchTemplateNormalisation">MatchTemplateNormalisation</a></td><td class="doc"><p>Normalization.</p></td></tr><tr><td class="src">-&gt; <a href="OpenCV-Exception.html#t:CvExcept">CvExcept</a> (<a href="OpenCV-Core-Types-Mat.html#t:Mat">Mat</a> (<a href="OpenCV-TypeLevel.html#v:S">S</a> [rh, rw]) (<a href="OpenCV-TypeLevel.html#v:S">S</a> 1) (<a href="OpenCV-TypeLevel.html#v:S">S</a> <a href="file:///nix/store/cvd8q905vz2dx3jjyq8c5lx0bcrbknmi-ghc-8.2.2-doc/share/doc/ghc/html/libraries/base-4.10.1.0/Prelude.html#t:Float">Float</a>))</td><td class="doc"><p>Map of comparison results. It must be single-channel 32-bit
 floating-point. If image is \(W \times H\) and templ is
 \(w \times h\), then result is \((W-w+1) \times (H-h+1)\).</p></td></tr></table></div><div class="doc"><p>Compares a template against overlapped image regions.</p><p>The function slides through image, compares the overlapped patches of size
  \( w \times h \)
against templ using the specified method and stores the comparison
results in result. The summation is done over template and/or the image patch:
  \( x' = 0...w-1, y' = 0...h-1 \)</p><p>After the function finishes the comparison, the best matches can be found as
global minimums (when <code><a href="OpenCV-ImgProc-ObjectDetection.html#v:MatchTemplateSqDiff">MatchTemplateSqDiff</a></code> was used) or maximums (when
<code><a href="OpenCV-ImgProc-ObjectDetection.html#v:MatchTemplateCCorr">MatchTemplateCCorr</a></code> or <code><a href="OpenCV-ImgProc-ObjectDetection.html#v:MatchTemplateCCoeff">MatchTemplateCCoeff</a></code> was used) using the <code>minMaxLoc</code>
function. In case of a color image, template summation in the numerator and each
sum in the denominator is done over all of the channels and separate mean values
are used for each channel.  That is, the function can take a color template and
a color image. The result will still be a single-channel image, which is easier
to analyze.</p><p>Example:</p><pre>matchTemplateImg
    :: forall (width :: Nat) (height :: Nat) (width2 :: Nat)
     . ( Mat (ShapeT [height, width]) ('S 3) ('S Word8) ~ Kodak_512x341
       , width2 ~ (width + width)
       )
    =&gt; Mat (ShapeT [height, width2]) ('S 3) ('S Word8)
matchTemplateImg = exceptError $
    withMatM (Proxy :: Proxy [height, width2])
             (Proxy :: Proxy 3)
             (Proxy :: Proxy Word8)
             transparent $ \imgM -&gt; do
      matCopyToM imgM (V2 0 0) barn_512x341 Nothing
      rectangle imgM templateRect blue 1 LineType_8 0
      matCopyToM imgM (V2 width 0) resultImg Nothing
      rectangle imgM matchRect blue 1 LineType_8 0
  where
    -- Recovered location of <code>template</code>, translated for rendering.
    matchRect :: Rect2i
    matchRect = toRect $ HRect (fromPoint maxLoc ^+^ V2 width 0)
                               (V2 20 20)

    -- Find location of best match in <code>result</code>.
    _minVal, _maxVal :: Double
    _minLoc, maxLoc :: Point2i
    (_minVal, _maxVal, _minLoc, maxLoc) = exceptError $ minMaxLoc result

    -- Result matrix converted to color image for rendering.
    resultImg :: Mat ('S ['D, 'D]) ('S 3) ('S Word8)
    resultImg = exceptError $ do
        resultGray
            :: Mat ('S ['D, 'D]) ('S 1) ('S Word8)
            &lt;- matConvertTo (Just 255) Nothing result
        cvtColor gray bgr resultGray

    -- Result of looking for <code>template</code> in <code>barn_512x341</code>.
    result :: Mat ('S ['D, 'D]) ('S 1) ('S Float)
    result = exceptError $
        matchTemplate barn_512x341 template MatchTemplateCCoeff MatchTemplateNormed

    -- Small part of the barn image which we want to find again.
    template :: Mat ('S ['D, 'D]) ('S 3) ('S Word8)
    template = exceptError $ matSubRect barn_512x341 templateRect

    -- Rectangle that defines a small part of the barn image.
    templateRect :: Rect2i
    templateRect = toRect $ HRect (V2 183 24) (V2 20 20)

    width :: Int32
    width = fromInteger $ natVal (Proxy :: Proxy width)
</pre><p><img src="doc/generated/examples/matchTemplateImg.png" title="matchTemplateImg" /></p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.18.1</p></div></body></html>